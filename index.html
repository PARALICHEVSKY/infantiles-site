<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NightShift — Ночная смена (FNAF-like)</title>
<style>
  :root{--bg:#0b0b10;--panel:#0f1720;--accent:#9be3ff}
  html,body{height:100%;margin:0;background:var(--bg);color:#e6eef6;font-family:Inter,Segoe UI,Arial,sans-serif}
  .wrap{max-width:1000px;margin:18px auto;display:flex;gap:14px}
  .left{flex:1;background:var(--panel);border-radius:10px;padding:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
  .right{width:320px;background:linear-gradient(180deg,#0c1218,#0b1014);border-radius:10px;padding:12px}
  canvas{display:block;width:100%;height:420px;border-radius:6px;background:#05060a}
  h1{font-size:18px;margin:0 0 8px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  button{background:#18222b;color:#dbe9f8;border:0;padding:10px;border-radius:8px;cursor:pointer;font-weight:700}
  button.toggled{background:#6b9e6f;color:#fff}
  .stat{margin:8px 0}
  .meter{height:12px;background:#071018;border-radius:6px;overflow:hidden}
  .meter > i{display:block;height:100%;background:linear-gradient(90deg,#68f,#39f);width:100%}
  .log{height:140px;overflow:auto;background:#050914;border-radius:6px;padding:8px;border:1px solid rgba(255,255,255,0.03);font-size:13px}
  footer{color:#88a;opacity:0.8;margin-top:8px}
  .titleRow{display:flex;justify-content:space-between;align-items:center}
</style>
</head>
<body>
  <div class="wrap">
    <div class="left">
      <div class="titleRow"><h1>NightShift — Ночная смена</h1><div id="clockDisplay">20:00</div></div>
      <canvas id="mainCanvas" width="720" height="420"></canvas>
      <div class="controls">
        <button id="camBtn">Камеры</button>
        <button id="leftDoor">Дверь слева</button>
        <button id="rightDoor">Дверь справа</button>
        <button id="leftLight">Свет слева</button>
        <button id="rightLight">Свет справа</button>
        <button id="muteBtn">Звук</button>
      </div>
      <div style="margin-top:8px;color:#aebfd0;font-size:13px">Цель: продержать ночь с 00:00 до 06:00. Следи за камерами, сохраняй энергию — закрывать двери и свет тратит энергию.</div>
    </div>

    <div class="right">
      <div style="display:flex;justify-content:space-between;align-items:center"><div><strong>Энергия</strong></div><div id="energyVal">100%</div></div>
      <div class="meter" style="margin-top:6px"><i id="energyBar" style="width:100%"></i></div>

      <div class="stat"><strong>Камера</strong><div id="camName">Камера 1</div></div>
      <div class="stat"><strong>Аниматроники</strong><div id="aiList">Близко: —</div></div>

      <div style="margin-top:8px"><strong>События</strong>
        <div class="log" id="log"></div>
      </div>

      <div style="margin-top:10px;display:flex;gap:8px"><button id="startBtn">Начать смену</button><button id="restartBtn">Рестарт</button></div>
      <footer>Игра — демо. Можно расширить: дополнительные камеры, ночи, сложность, звуки и спрайты.</footer>
    </div>
  </div>

<script>
// NightShift — simplified FNAF-like browser demo
(() => {
  const canvas = document.getElementById('mainCanvas');
  const ctx = canvas.getContext('2d');
  const energyBar = document.getElementById('energyBar');
  const energyVal = document.getElementById('energyVal');
  const logEl = document.getElementById('log');
  const camNameEl = document.getElementById('camName');
  const aiListEl = document.getElementById('aiList');
  const clockDisplay = document.getElementById('clockDisplay');

  // buttons
  const camBtn = document.getElementById('camBtn');
  const leftDoorBtn = document.getElementById('leftDoor');
  const rightDoorBtn = document.getElementById('rightDoor');
  const leftLightBtn = document.getElementById('leftLight');
  const rightLightBtn = document.getElementById('rightLight');
  const startBtn = document.getElementById('startBtn');
  const restartBtn = document.getElementById('restartBtn');
  const muteBtn = document.getElementById('muteBtn');

  // game state
  let running = false;
  let showCams = false;
  let currentCam = 0;
  let energy = 100;
  let timeMinutes = 20*60; // start 20:00 (use minutes as seconds here for demo speed)
  let targetEnd = 6*60; // 6:00
  let tickInterval = null;
  let ai = [];
  let audioOn = true;

  function log(msg){ const t = new Date().toLocaleTimeString(); logEl.innerHTML = '['+t+'] '+msg + '<br>' + logEl.innerHTML; }

  // simple animatronics with positions across map nodes
  const mapNodes = ['Stage','Hall','Dining','Kitchen','LeftDoor','RightDoor','Office'];
  function createAI(name, start, speed, aggressiveness){
    return {name, pos:start, speed, aggression:aggressiveness, lastMove:0, active:true}
  }

  function resetGame(){
    running=false; showCams=false; currentCam=0; energy=100; timeMinutes = 20*60; ai = [];
    ai.push(createAI('Марио', 0, 6, 0.15));
    ai.push(createAI('Бот', 0, 5, 0.12));
    updateUI(); drawOffice(); log('Игра готова. Нажми "Начать смену".');
    if(tickInterval) clearInterval(tickInterval);
  }

  function startGame(){ if(running) return; running=true; log('Смена началась. Удачи.'); tickInterval = setInterval(tick, 1000); }
  function endGame(win, reason){ running=false; clearInterval(tickInterval); tickInterval=null; if(win) { log('Вы продержались до 06:00 — Победа!'); showWin(); } else { log('Джампскэр! ' + reason); showJumpscare(reason); } }

  function tick(){
    // advance in-game clock faster (demo): every real second -> 1 in-game minute
    timeMinutes += 1; // 1-minute steps
    const hours = Math.floor((timeMinutes/60))%24;
    const mins = Math.floor(timeMinutes%60);
    clockDisplay.textContent = String(hours).padStart(2,'0')+':' + String(mins).padStart(2,'0');

    // energy drain by systems
    let drain = 0.2; // baseline
    if(leftDoorBtn.classList.contains('toggled')) drain += 0.8;
    if(rightDoorBtn.classList.contains('toggled')) drain += 0.8;
    if(leftLightBtn.classList.contains('toggled')) drain += 0.3;
    if(rightLightBtn.classList.contains('toggled')) drain += 0.3;
    if(showCams) drain += 0.25;
    energy = Math.max(0, energy - drain);
    energyBar.style.width = energy + '%'; energyVal.textContent = Math.round(energy) + '%';

    if(energy <= 0){ endGame(false, 'Отсутствие энергии — системы не работают.'); return; }

    // move animatronics occasionally based on speed and aggression
    ai.forEach(a=>{
      if(!a.active) return;
      a.lastMove++;
      const moveThreshold = Math.max(2, Math.floor(a.speed / (1 + a.aggression* (1 - energy/100))));
      if(a.lastMove >= moveThreshold){
        a.lastMove = 0;
        if(Math.random() < a.aggression + (1 - energy/200)){
          // move forward towards office
          if(a.pos < mapNodes.length-1) a.pos++;
          log(a.name + ' передвинулся в ' + mapNodes[a.pos]);
        } else {
          // small chance to move back
          if(a.pos > 0 && Math.random()<0.1) { a.pos--; log(a.name + ' ушёл назад в ' + mapNodes[a.pos]); }
        }
      }
    });

    // check if someone reached office
    const atOffice = ai.filter(a=> a.pos >= mapNodes.length-1 && a.active);
    if(atOffice.length>0){
      // if corresponding door closed or light on, they may be held back
      const leftHere = ai.filter(a=> mapNodes[a.pos] === 'LeftDoor');
      const rightHere = ai.filter(a=> mapNodes[a.pos] === 'RightDoor');
      const officeHere = atOffice;
      // if any reach office, check doors
      const officeInvaded = ai.some(a => a.pos === mapNodes.length-1);
      if(officeInvaded){
        // if either door closed? in this simplified demo, doors block LeftDoor/RightDoor nodes
        const leftClosed = leftDoorBtn.classList.contains('toggled');
        const rightClosed = rightDoorBtn.classList.contains('toggled');
        // if animatronic attempted to pass through a door node when closed, he stays
        // but if already at office node we check immediate game over
        // check probability to jumpscare based on closeness + low energy
        let danger = 0.7; // default
        if(energy > 30) danger -= 0.25;
        if(leftClosed || rightClosed) danger -= 0.3;
        if(Math.random() < danger){ endGame(false, 'Кто-то добрался до офиса.'); return; }
      }
    }

    // win condition (we're counting until 6:00)
    if(hours >= 6){ endGame(true); return; }

    updateUI();
    drawOffice();
  }

  function updateUI(){ camNameEl.textContent = 'Камера '+(currentCam+1); aiListEl.textContent = ai.map(a => a.name+': '+mapNodes[a.pos]).join('; '); }

  // UI toggles
  camBtn.addEventListener('click', ()=>{ showCams = !showCams; camBtn.classList.toggle('toggled', showCams); drawOffice(); });
  leftDoorBtn.addEventListener('click', ()=>{ leftDoorBtn.classList.toggle('toggled'); });
  rightDoorBtn.addEventListener('click', ()=>{ rightDoorBtn.classList.toggle('toggled'); });
  leftLightBtn.addEventListener('click', ()=>{ leftLightBtn.classList.toggle('toggled'); });
  rightLightBtn.addEventListener('click', ()=>{ rightLightBtn.classList.toggle('toggled'); });
  muteBtn.addEventListener('click', ()=>{ audioOn = !audioOn; muteBtn.classList.toggle('toggled', !audioOn); muteBtn.textContent = audioOn? 'Звук' : 'Без звука'; });

  startBtn.addEventListener('click', startGame);
  restartBtn.addEventListener('click', ()=>{ resetGame(); });

  // drawing: either office view or camera grid
  function drawOffice(){ ctx.clearRect(0,0,canvas.width,canvas.height);
    // background office
    ctx.fillStyle='#0b0f14'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#1a1f25'; ctx.fillRect(40,40,440,340);
    ctx.fillStyle='#2a3036'; ctx.fillRect(520,40,160,340);
    // desk
    ctx.fillStyle='#3b2f26'; ctx.fillRect(80,250,120,100);
    // doors indicators
    ctx.fillStyle = leftDoorBtn.classList.contains('toggled') ? '#ff4d4d' : '#2b2f34'; ctx.fillRect(30,160,10,60);
    ctx.fillStyle = rightDoorBtn.classList.contains('toggled') ? '#ff4d4d' : '#2b2f34'; ctx.fillRect(690-10,160,10,60);

    // lights
    if(leftLightBtn.classList.contains('toggled')){ ctx.fillStyle='rgba(255,255,200,0.08)'; ctx.fillRect(0,0,200,420); }
    if(rightLightBtn.classList.contains('toggled')){ ctx.fillStyle='rgba(255,255,200,0.06)'; ctx.fillRect(520,0,200,420); }

    // draw simple animatronics on map if camera mode
    const nodeX = [100,200,300,380,480,560,640];
    const nodeY = [120,120,120,120,200,200,120];
    ctx.fillStyle='#223'; ctx.font='12px sans-serif';
    for(let i=0;i<mapNodes.length;i++){ ctx.fillStyle='#162022'; ctx.fillRect(nodeX[i]-28,nodeY[i]-28,56,56); ctx.fillStyle='#88b'; ctx.fillText(mapNodes[i], nodeX[i]-22, nodeY[i]+40); }

    // draw ai as circles
    ai.forEach((a,idx)=>{
      const x = nodeX[a.pos]; const y = nodeY[a.pos];
      ctx.beginPath(); ctx.fillStyle = idx===0? '#b86' : '#6ab'; ctx.arc(x,y,16,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#111'; ctx.fillText(a.name, x-18, y+32);
    });

    // if camera view active, show a grid overlay
    if(showCams){ ctx.strokeStyle='rgba(200,220,255,0.06)'; ctx.lineWidth=2; ctx.strokeRect(48,48,420,320); ctx.fillStyle='rgba(255,255,255,0.02)'; ctx.fillRect(48,48,420,320); ctx.fillStyle='#cde'; ctx.font='14px sans-serif'; ctx.fillText('Камеры — обзор коридоров', 60,70); }

    // draw office camera window on the right
    ctx.fillStyle='#051018'; ctx.fillRect(528,56,144,96); ctx.fillStyle='#9bd'; ctx.fillText('Монитор', 540,72);
  }

  // simple jumpscare overlay
  function showJumpscare(reason){ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#fff'; ctx.font='42px sans-serif'; ctx.fillText('!!! ДЖАМПСКЭЙР !!!', 80,200); ctx.font='18px sans-serif'; ctx.fillText(reason, 80,240); }
  function showWin(){ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#071'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#eaf'; ctx.font='28px sans-serif'; ctx.fillText('Ты продержался! Победа!', 80,200); }

  // init
  resetGame();
})();
</script>
</body>
</html>
