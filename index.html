<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–°–û–°–ê–õ? ‚Äî –ú–µ–º‚Äë–∞—Ä–∫–∞–¥–∞</title>
  <meta name="description" content="–°—É–º–∞—Å—à–µ–¥—à–∞—è –º–µ–º-–∏–≥—Ä–∞: –∫–Ω–æ–ø–∫–∞ —É–±–µ–≥–∞–µ—Ç, —É—Ä–æ–≤–Ω–∏, –±–æ—Å—Å—ã, —Ä–µ–∫–æ—Ä–¥—ã –∏ —Å–µ–∫—Ä–µ—Ç—ã" />
  <style>
    :root{
      --bg1:#071021; --bg2:#0f1130; --card:#0f1724; --text:#e6eef8; --accent:#7c5cff; --good:#10b981; --bad:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;overflow:hidden;background:linear-gradient(120deg,var(--bg1),var(--bg2));color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{position:relative;display:flex;align-items:center;justify-content:center;height:100vh;padding:24px}
    .card{width:min(980px,96vw);background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.06);backdrop-filter:blur(6px);border-radius:18px;padding:20px 22px;position:relative;z-index:30}
    header{display:flex;align-items:center;gap:18px;justify-content:space-between}
    h1{margin:0;font-size:clamp(28px,5vw,48px);background:linear-gradient(90deg,#fff,#c7d2fe);-webkit-background-clip:text;background-clip:text;color:transparent}
    .controls{display:flex;gap:12px;align-items:center}
    select,input[type=range]{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);color:var(--text);padding:6px;border-radius:8px}
    .main{display:flex;gap:18px;margin-top:14px}
    .play{flex:1;min-height:320px;position:relative;overflow:hidden;padding:18px;border-radius:12px;border:1px dashed rgba(255,255,255,0.03)}
    .hud{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.03);padding:10px 16px;border-radius:999px;color:var(--text);cursor:pointer;user-select:none}
    .btn:active{transform:translateY(1px)}
    .btn.yes{background:linear-gradient(90deg,rgba(16,185,129,0.18),rgba(16,185,129,0.12));border-color:rgba(16,185,129,0.4)}
    .btn.no{background:linear-gradient(90deg,rgba(239,68,68,0.12),rgba(239,68,68,0.06));border-color:rgba(239,68,68,0.3);position:absolute}
    .score{font-weight:700}
    .leader{width:260px;padding:12px;border-radius:12px;background:rgba(0,0,0,0.12);border:1px solid rgba(255,255,255,0.03)}
    .leader h3{margin:0 0 8px 0}
    ol{padding-left:18px;margin:0}

    /* flying letters */
    .floating-letter{position:absolute;font-weight:800;font-size:clamp(36px,5vw,96px);opacity:.12;mix-blend-mode:screen;pointer-events:none;will-change:transform}

    /* matrix */
    .matrix{position:absolute;inset:0;background:linear-gradient(transparent,rgba(0,0,0,0.3));color:#00ff44;font-family:monospace;font-size:14px;display:none;z-index:20}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:60}
    .modal .box{background:#071022;padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);max-width:90vw}

    /* small helpers */
    .muted{opacity:.75;font-size:13px}
    .theme-dot{width:12px;height:12px;border-radius:50%;display:inline-block;margin-right:6px}

    /* emoji rain */
    .emoji{position:fixed;top:-50px;font-size:28px;pointer-events:none;z-index:10}

    /* screen shake helper */
    .shake{animation:shake 0.4s}
    @keyframes shake{0%{transform:translate(0,0)}25%{transform:translate(-8px,6px) rotate(-2deg)}50%{transform:translate(6px,-6px) rotate(2deg)}75%{transform:translate(-6px,6px) rotate(-1deg)}100%{transform:translate(0,0)}}

  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="gameCard">
      <header>
        <h1 id="title">–°–û–°–ê–õ? ‚Äî –ú–µ–º‚Äë–∞—Ä–∫–∞–¥–∞</h1>
        <div class="controls">
          <label class="muted">–¢–µ–º–∞
            <select id="themeSel">
              <option value="neon">–ù–µ–æ–Ω</option>
              <option value="matrix">–ú–∞—Ç—Ä–∏—Ü–∞</option>
              <option value="fire">–û–≥–æ–Ω—å</option>
              <option value="ice">–õ—ë–¥</option>
            </select>
          </label>
          <label class="muted">–¢–∞–π–º <input id="roundTime" type="range" min="10" max="60" value="30"></label>
          <button class="btn" id="resetScores">–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã</button>
        </div>
      </header>

      <div class="main">
        <section class="play" id="playarea" aria-label="–ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞">
          <div class="hud" style="position:relative;z-index:12;margin-bottom:8px">
            <div>–û—á–∫–∏: <span class="score" id="score">0</span></div>
            <div>–†–µ–∫–æ—Ä–¥: <span id="highscore">0</span></div>
            <div>–ö–æ–º–±–æ: <span id="combo">x1</span></div>
            <div>–†–∞—É–Ω–¥: <span id="roundNum">1</span></div>
            <div>–í—Ä–µ–º—è: <span id="timeLeft">30</span>s</div>
          </div>

          <!-- floating title letters -->
          <div id="lettersLayer"></div>

          <!-- NO button starts here -->
          <button class="btn no" id="noBtn">–ù–µ—Ç</button>
          <button class="btn yes" id="yesBtn" style="position:relative;left:auto;top:auto">–î–∞</button>

          <!-- matrix effect -->
          <canvas id="matrix" class="matrix"></canvas>
        </section>

        <aside class="leader">
          <h3>–¢–æ–ø‚Äë5 —Ä–µ–∫–æ—Ä–¥–æ–≤</h3>
          <ol id="board"></ol>
          <div style="margin-top:12px">
            <button class="btn" id="startBtn">–°—Ç–∞—Ä—Ç</button>
            <button class="btn" id="pauseBtn">–ü–∞—É–∑–∞</button>
          </div>
          <div style="margin-top:12px;font-size:13px" class="muted">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage ¬∑ –°–µ–∫—Ä–µ—Ç—ã: amogus / shrek / rick</div>
        </aside>
      </div>
    </div>
  </div>

  <!-- modal for boss / rickroll / shrek -->
  <div class="modal" id="modal">
    <div class="box" id="modalBox"></div>
  </div>

  <!-- sounds -->
  <audio id="sClick" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
  <audio id="sWin" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="sBoss" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
  <audio id="sShrek" src="https://actions.google.com/sounds/v1/human_voices/evil_laugh.ogg"></audio>

  <script>
    /* ======= Game State ======= */
    const scoreEl = document.getElementById('score');
    const highscoreEl = document.getElementById('highscore');
    const comboEl = document.getElementById('combo');
    const timeLeftEl = document.getElementById('timeLeft');
    const roundNumEl = document.getElementById('roundNum');
    const boardEl = document.getElementById('board');
    const playarea = document.getElementById('playarea');
    const noBtn = document.getElementById('noBtn');
    const yesBtn = document.getElementById('yesBtn');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const modal = document.getElementById('modal');
    const modalBox = document.getElementById('modalBox');
    const title = document.getElementById('title');

    const sClick = document.getElementById('sClick');
    const sWin = document.getElementById('sWin');
    const sBoss = document.getElementById('sBoss');
    const sShrek = document.getElementById('sShrek');

    let score = 0;
    let highscore = Number(localStorage.getItem('sosal_high')||0);
    highscoreEl.textContent = highscore;

    let combo = 0; let comboTimer = null; let multiplier = 1;
    let running = false; let paused = false;
    let roundTimeInput = document.getElementById('roundTime');
    let timeLeft = Number(roundTimeInput.value);
    timeLeftEl.textContent = timeLeft;
    let round = 1;

    // leaderboard top5
    function loadBoard(){
      const data = JSON.parse(localStorage.getItem('sosal_board')||'[]');
      boardEl.innerHTML = '';
      for(let i=0;i<5;i++){ const item=data[i]; const li=document.createElement('li'); li.textContent = item? `${item.name} ‚Äî ${item.score}` : '‚Äî'; boardEl.appendChild(li); }
    }
    loadBoard();

    /* ===== Floating letters (–ª–µ—Ç—è—Ç –∫–∞–∫ –≤ –∫–æ—Å–º–æ—Å–µ) ===== */
    const lettersLayer = document.getElementById('lettersLayer');
    const phrase = '–°–û–°–ê–õ?';
    function spawnLetters(){
      lettersLayer.innerHTML = '';
      for(let i=0;i<phrase.length;i++){
        const el = document.createElement('div');
        el.className='floating-letter';
        el.textContent = phrase[i];
        const x = Math.random()*70+10; const y = Math.random()*50+10;
        el.style.left = x+'%'; el.style.top = y+'%';
        el.style.transform = `translate(-50%,-50%) rotate(${Math.random()*40-20}deg)`;
        el.style.fontSize = (48 + Math.random()*80) + 'px';
        lettersLayer.appendChild(el);
        // animate drift
        (function(el){
          const dx = (Math.random()*2-1)*30; const dy = (Math.random()*2-1)*30; const dur = 8000+Math.random()*10000;
          el.animate([{transform:el.style.transform},{transform:`translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px)) rotate(${Math.random()*20-10}deg)`},{transform:el.style.transform}],{duration:dur,iterations:Infinity,direction:'alternate',easing:'ease-in-out'});
        })(el);
      }
    }
    spawnLetters();

    /* ===== Matrix background ===== */
    const matrixCanvas = document.getElementById('matrix');
    const mctx = matrixCanvas.getContext('2d');
    function resizeMatrix(){matrixCanvas.width=playarea.clientWidth;matrixCanvas.height=playarea.clientHeight;}
    resizeMatrix();window.addEventListener('resize',resizeMatrix);
    let matrixRunning=false;
    function startMatrix(){matrixCanvas.style.display='block';matrixRunning=true;const cols = Math.floor(matrixCanvas.width/14);const ypos = Array(cols).fill(0);
      function mloop(){mctx.fillStyle='rgba(0,0,0,0.05)';mctx.fillRect(0,0,matrixCanvas.width,matrixCanvas.height);mctx.fillStyle='#0f0';mctx.font='14px monospace';for(let i=0;i<cols;i++){const text = String.fromCharCode(33+Math.random()*96);mctx.fillText(text,i*14,ypos[i]*14); if(ypos[i]*14 > matrixCanvas.height && Math.random()>0.975) ypos[i]=0; ypos[i]++;}
        if(matrixRunning) requestAnimationFrame(mloop); else mctx.clearRect(0,0,matrixCanvas.width,matrixCanvas.height);
      }
      mloop();
    }
    function stopMatrix(){matrixRunning=false;matrixCanvas.style.display='none'}

    /* ===== Emoji rain ===== */
    function spawnEmoji(){const e=document.createElement('div');e.className='emoji';e.textContent=['üòÇ','üî•','üòà','üçÜ','üëΩ','üíÄ'][Math.floor(Math.random()*6)];e.style.left=Math.random()*100+'vw';e.style.fontSize=(16+Math.random()*40)+'px';document.body.appendChild(e);const dur=3000+Math.random()*4000;e.style.transition=`transform ${dur}ms linear, opacity ${dur}ms`;setTimeout(()=>{e.style.transform=`translateY(${110+Math.random()*20}vh)`;e.style.opacity='0'},20);setTimeout(()=>e.remove(),dur+100)}

    /* ===== Boss (–∫–Ω–æ–ø–∫–∞‚Äë–±–æ—Å—Å) ===== */
    function spawnBoss(){
      // modal boss with big button that needs several clicks
      modal.style.display='flex';
      modalBox.innerHTML = `<h3>–ë–û–°–°!</h3><p>–ù–∞–∂–º–∏ –Ω–∞ –±–æ–ª—å—à—É—é –∫–Ω–æ–ø–∫—É ${5+Math.floor(Math.random()*10)} —Ä–∞–∑!</p><div style="display:flex;gap:10px;align-items:center;margin-top:12px"><button id='bossBtn' class='btn' style='padding:22px 40px;font-size:20px'>–£–î–ê–†–ò–¢–¨</button><div id='bossHits'>0</div></div>`;
      let hits=0; const need = 5+Math.floor(Math.random()*10);
      document.getElementById('bossHits').textContent=`0/${need}`;
      document.getElementById('bossBtn').onclick = ()=>{hits++;document.getElementById('bossHits').textContent=`${hits}/${need}`;sBoss.currentTime=0;sBoss.play(); if(hits>=need){modal.style.display='none';updateScore(need*10);burst(window.innerWidth/2,window.innerHeight/2)}};
    }

    /* ===== Scoring, combo, UI helpers ===== */
    function updateScore(n){score += n * multiplier; scoreEl.textContent = score; if(score>highscore){highscore = score; highscoreEl.textContent = highscore; localStorage.setItem('sosal_high',highscore);} }

    function addCombo(){combo++; multiplier = 1 + Math.floor(combo/5); comboEl.textContent = 'x'+multiplier; if(comboTimer) clearTimeout(comboTimer); comboTimer = setTimeout(()=>{combo=0;multiplier=1;comboEl.textContent='x1'},3000)}

    /* confetti simple */
    const confCanvas = document.getElementById('fx') || (function(){ const c=document.createElement('canvas'); c.id='fx'; document.body.appendChild(c); return c})();
    const cctx = confCanvas.getContext('2d'); function resizeConf(){confCanvas.width=window.innerWidth;confCanvas.height=window.innerHeight;} resizeConf(); window.addEventListener('resize',resizeConf);
    let confs = [];
    function burst(x,y){ for(let i=0;i<120;i++){confs.push({x,y,vx:(Math.random()*2-1)*8,vy:(Math.random()*2-1)*8-4,g:0.18+sRand(0,.12),s:3+Math.random()*6,r:Math.random()*Math.PI,vr:(Math.random()*2-1)*0.3,life:60+Math.random()*60}) } if(!confLoop) confLoop = requestAnimationFrame(confettiLoop); }
    function sRand(a,b){return a + Math.random()*(b-a)}
    let confLoop=0; function confettiLoop(){ cctx.clearRect(0,0,confCanvas.width,confCanvas.height); confs = confs.filter(p=>p.life>0); for(const p of confs){ p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.r+=p.vr; p.life--; cctx.save(); cctx.translate(p.x,p.y); cctx.rotate(p.r); cctx.fillStyle = `hsl(${(p.x+p.y)%360},80%,60%)`; cctx.fillRect(-p.s/2,-p.s/2,p.s,p.s); cctx.restore() } if(confs.length) confLoop = requestAnimationFrame(confettiLoop); else { cancelAnimationFrame(confLoop); confLoop=0; } }

    /* ===== Fake buttons generator ===== */
    function spawnFakeButton(){const f=document.createElement('button');f.className='btn';f.textContent = Math.random()<0.6 ? (Math.random()<0.5 ? '–î–∞' : '–ù–µ—Ç') : (Math.random()<0.5 ? '–ü–æ–¥–æ–∂–¥–∏' : '–õ–æ–∂—å'); f.style.position='absolute'; f.style.left = (10 + Math.random()*70) +'%'; f.style.top = (10 + Math.random()*60) +'%'; f.onclick = ()=>{f.remove(); subtitleFlash('–§–µ–π–∫! +0');}; document.querySelector('.play').appendChild(f); setTimeout(()=>f.remove(),2500)}

    function subtitleFlash(txt){const old = title.textContent; title.textContent = txt; setTimeout(()=>title.textContent = '–°–û–°–ê–õ? ‚Äî –ú–µ–º‚Äë–∞—Ä–∫–∞–¥–∞',800)}

    /* ===== Themes and effects ===== */
    const themeSel = document.getElementById('themeSel');
    function applyTheme(t){ document.body.dataset.theme = t; if(t==='matrix'){startMatrix()} else {stopMatrix()} if(t==='fire'){ document.body.style.background='linear-gradient(120deg,#2b0000,#4b0710)'; } else if(t==='ice'){ document.body.style.background='linear-gradient(120deg,#021428,#0b2a44)'; } else if(t==='neon'){ document.body.style.background='linear-gradient(120deg,#071021,#0f1130)'; } }
    themeSel.value = localStorage.getItem('sosal_theme') || 'neon'; applyTheme(themeSel.value);
    themeSel.addEventListener('change',()=>{localStorage.setItem('sosal_theme',themeSel.value); applyTheme(themeSel.value)});

    /* ===== No button behaviour (–≥–ª–∞–≤–Ω–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞) ===== */
    function moveNo(){ if(!running || paused) return; // choose behavior by difficulty and round
      const rect = document.querySelector('.play').getBoundingClientRect(); const b = noBtn.getBoundingClientRect(); const pad=8;
      const difficulty = getDifficulty();
      const speedFactor = difficulty==='easy' ? 1 : difficulty==='normal' ? 1.8 : 3.2;
      // random teleport or smooth move
      if(Math.random() < 0.12 * speedFactor){ // teleport
        noBtn.style.left = (pad + Math.random()*(rect.width - b.width - pad*2)) + 'px'; noBtn.style.top = (pad + Math.random()*(rect.height - b.height - pad*2)) + 'px';
      } else { // animated move
        const nx = pad + Math.random()*(rect.width-b.width-pad*2); const ny = pad + Math.random()*(rect.height-b.height-pad*2);
        noBtn.animate([{left:noBtn.style.left || '20px', top:noBtn.style.top || '20px'},{left:nx+'px', top:ny+'px'}],{duration:600/speedFactor,fill:'forwards',easing:'cubic-bezier(.2,.9,.2,1)'});
      }
      // sometimes turn into a Yes
      if(Math.random() < 0.12 * speedFactor){ noBtn.textContent='–î–∞ üòà'; noBtn.onclick = ()=>{ yesBtnClick(); noBtn.textContent='–ù–µ—Ç'; noBtn.onclick=null }; }
    }

    noBtn.addEventListener('pointerenter',()=>{ if(!running || paused) return; sClick.currentTime=0; sClick.play(); addCombo(); updateScore(1*multiplier); moveNo(); if(Math.random()<0.07) spawnFakeButton(); if(Math.random()<0.03) spawnEmoji(); if(Math.random()<0.02) spawnBoss(); if(Math.random()<0.05 && round>2) shakeScreen(); });

    function yesBtnClick(){ sWin.currentTime=0; sWin.play(); updateScore(10*multiplier); addCombo(); burst(window.innerWidth/2, window.innerHeight/2); }
    yesBtn.addEventListener('click', yesBtnClick);

    /* ===== timer / rounds / start / pause ===== */
    function getDifficulty(){return document.getElementById('mode')?document.getElementById('mode').value: (localStorage.getItem('sosal_mode')||'normal')}
    // ensure mode exists (backward)
    if(!document.getElementById('mode')){
      const sel=document.createElement('select'); sel.id='mode'; sel.innerHTML='<option value="easy">–õ—ë–≥–∫–∏–π</option><option value="normal" selected>–ù–æ—Ä–º</option><option value="hell">–ê–¥—Å–∫–∏–π</option>'; document.querySelector('.controls').appendChild(sel);
    }

    function startGame(){ if(running) return; running=true; paused=false; score=0; scoreEl.textContent=0; round=1; roundNumEl.textContent=1; timeLeft = Number(roundTimeInput.value); timeLeftEl.textContent=timeLeft; spawnLetters(); startRoundTimer(); }
    function pauseGame(){ paused = !paused; pauseBtn.textContent = paused ? '–í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å' : '–ü–∞—É–∑–∞'; }

    function endRound(){ // increase difficulty a bit and continue
      round++; roundNumEl.textContent = round; // give small bonus and spawn chaos
      updateScore(20*round);
      // make it slightly harder by spawning more fake buttons and emojis
      for(let i=0;i<3+round;i++){ if(Math.random()<0.6) spawnFakeButton(); if(Math.random()<0.6) spawnEmoji(); }
      // if rounds multiple of 3, spawn boss
      if(round%3===0) setTimeout(spawnBoss,800);
      // shorten timer progressively
      timeLeft = Math.max(8, Number(roundTimeInput.value) - Math.floor(round*2)); timeLeftEl.textContent=timeLeft; startRoundTimer();
    }

    let roundTimer = null;
    function startRoundTimer(){ if(roundTimer) clearInterval(roundTimer); roundTimer = setInterval(()=>{ if(paused) return; timeLeft--; timeLeftEl.textContent=timeLeft; if(timeLeft<=0){ clearInterval(roundTimer); endRound(); } },1000); }

    startBtn.addEventListener('click', ()=>{ startGame(); })
    pauseBtn.addEventListener('click', ()=>{ pauseGame(); })

    // update leaderboard at end of game (on manual stop)
    function finishGame(){ running=false; clearInterval(roundTimer); // prompt for name
      const name = prompt('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤ (max 12)') || 'anon'; const entry = {name: name.slice(0,12), score};
      // save to board
      const data = JSON.parse(localStorage.getItem('sosal_board')||'[]'); data.push(entry); data.sort((a,b)=>b.score-a.score); localStorage.setItem('sosal_board', JSON.stringify(data.slice(0,5))); loadBoard();
      // reset some UI
      localStorage.setItem('sosal_high', Math.max(Number(localStorage.getItem('sosal_high')||0), score)); highscore = Number(localStorage.getItem('sosal_high')); highscoreEl.textContent=highscore; document.getElementById('noBtn').style.display='none';
    }

    // quick end when modal closed after boss
    modal.addEventListener('click',(e)=>{ if(e.target===modal) modal.style.display='none' });

    // reset scores
    document.getElementById('resetScores').addEventListener('click',()=>{ if(confirm('–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã –∏ —Ç–∞–±–ª–∏—Ü—É?')){ localStorage.removeItem('sosal_board'); localStorage.removeItem('sosal_high'); loadBoard(); highscore=0; highscoreEl.textContent=0 } });

    /* ===== secret codes: amogus / shrek / rick ===== */
    const buffer = [];
    const secrets = {
      'amogus': ()=>{ // spawn red amogus obstacles that cover buttons
        for(let i=0;i<6;i++){ const d=document.createElement('div'); d.textContent='‚õî'; d.style.position='absolute'; d.style.left=(10+Math.random()*70)+'%'; d.style.top=(10+Math.random()*60)+'%'; d.style.fontSize='48px'; d.style.zIndex=50; document.querySelector('.play').appendChild(d); setTimeout(()=>d.remove(),4000); }
      },
      'shrek': ()=>{ // show shrek modal and +50 points
        modal.style.display='flex'; modalBox.innerHTML=`<h3>–®—Ä–µ–∫ –æ–¥–æ–±—Ä—è–µ—Ç</h3><img src="https://upload.wikimedia.org/wikipedia/en/3/33/Shrek_%28character%29.png" alt="shrek" style="width:160px"><p>+50 –æ—á–∫–æ–≤</p><button class='btn' id='okShrek'>OK</button>`; document.getElementById('okShrek').onclick=()=>{ sShrek.currentTime=0; sShrek.play(); updateScore(50); modal.style.display='none' }
      },
      'rick': ()=>{ // rickroll in modal
        modal.style.display='flex'; modalBox.innerHTML=`<h3>–†–∏–∫—Ä–æ–ª–ª!</h3><iframe width="420" height="236" src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe><button class='btn' id='closeRick'>–ó–∞–∫—Ä—ã—Ç—å</button>`; document.getElementById('closeRick').onclick=()=>modal.style.display='none'; }
    };

    window.addEventListener('keydown', (e)=>{
      buffer.push(e.key.toLowerCase()); if(buffer.length>20) buffer.shift(); const joined = buffer.join(''); for(const code in secrets){ if(joined.includes(code)){ secrets[code](); buffer.length=0; break } }
    });

    /* ===== screen shake ===== */
    function shakeScreen(){ const el=document.getElementById('gameCard'); el.classList.add('shake'); setTimeout(()=>el.classList.remove('shake'),400); }

    /* ===== board load initially ===== */
    loadBoard();

    /* ===== helper: random periodic chaos ===== */
    setInterval(()=>{ if(!running || paused) return; if(Math.random()<0.25) spawnEmoji(); if(Math.random()<0.12) spawnFakeButton(); if(Math.random()<0.05) spawnBoss(); if(Math.random()<0.08 && document.body.dataset.theme==='matrix') startMatrix(); if(Math.random()<0.02) burst(Math.random()*innerWidth, Math.random()*innerHeight); },1200);

    // save mode
    const modeSaved = localStorage.getItem('sosal_mode') || 'normal';
    // create mode select (if not exists) and sync
    let modeSel = document.getElementById('mode'); if(!modeSel){ modeSel = document.createElement('select'); modeSel.id='mode'; modeSel.innerHTML='<option value="easy">–õ—ë–≥–∫–∏–π</option><option value="normal">–ù–æ—Ä–º</option><option value="hell">–ê–¥—Å–∫–∏–π</option>'; document.querySelector('.controls').appendChild(modeSel); }
    modeSel.value = localStorage.getItem('sosal_mode')||'normal'; modeSel.addEventListener('change',()=>{ localStorage.setItem('sosal_mode',modeSel.value); });

    // Save round time
    roundTimeInput.addEventListener('change',()=>localStorage.setItem('sosal_time',roundTimeInput.value)); if(localStorage.getItem('sosal_time')){ roundTimeInput.value = localStorage.getItem('sosal_time'); timeLeft = Number(roundTimeInput.value); timeLeftEl.textContent=timeLeft }

    // when window unfocused pause
    window.addEventListener('blur',()=>{ if(running && !paused) { paused=true; pauseBtn.textContent='–í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å'; } });

    // expose finish for debug
    window.finishGame = finishGame;

    // start automatically
    // startGame();

  </script>
</body>
</html>